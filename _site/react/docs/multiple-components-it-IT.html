<p>Finora abbiamo visto come scrivere un singolo componente per mostrare dati e gestire l&#39;input dell&#39;itente. Adesso esaminiamo una delle migliori caratteristiche di React: la componibilità.</p>
<h2><a class="anchor" name="motivazione-separazione-dei-concetti"></a>Motivazione: Separazione dei Concetti <a class="hash-link" href="#motivazione-separazione-dei-concetti">#</a></h2>
<p>Costruendo componenti modulari che riutilizzano altri componenti con interfacce ben definite, ottieni gli stessi benefici che otterresti usando funzioni o classi. Nello specifico, puoi <em>separare i diversi concetti</em> della tua applicazione nel modo che preferisci semplicemente costruendo nuovi componenti. Costruendo una libreria di componenti personalizzati per la tua applicazione, stai esprimendo la tua UI in una maniera che si adatta meglio al tuo dominio.</p>
<h2><a class="anchor" name="esepmio-di-composizione"></a>Esepmio di Composizione <a class="hash-link" href="#esepmio-di-composizione">#</a></h2>
<p>Creiamo un semplice componente Avatar che mostra una foto del profilo e un nome utente usando la Graph API di Facebook.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">Avatar</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">ProfilePic</span> <span class="nx">username</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">username</span><span class="p">}</span> <span class="o">/&gt;</span>
        <span class="o">&lt;</span><span class="nx">ProfileLink</span> <span class="nx">username</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">username</span><span class="p">}</span> <span class="o">/&gt;</span>
      <span class="o">&lt;</span><span class="err">/div&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">ProfilePic</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;https://graph.facebook.com/&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">username</span> <span class="o">+</span> <span class="s1">&#39;/picture&#39;</span><span class="p">}</span> <span class="o">/&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">ProfileLink</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;https://www.facebook.com/&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">username</span><span class="p">}</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">username</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="err">/a&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

<span class="nx">ReactDOM</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span>
  <span class="o">&lt;</span><span class="nx">Avatar</span> <span class="nx">username</span><span class="o">=</span><span class="s2">&quot;pwh&quot;</span> <span class="o">/&gt;</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;example&#39;</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div><h2><a class="anchor" name="possesso"></a>Possesso <a class="hash-link" href="#possesso">#</a></h2>
<p>Nell&#39;esempio precedente, le istanze di <code>Avatar</code> <em>posseggono</em> instanze di <code>ProfilePic</code> e <code>ProfileLink</code>. In React, <strong>un proprietario è il componente che imposta le <code>props</code> di altri componenti</strong>. Più formalmente, se un componente <code>X</code> è creato nel metodo <code>render()</code> del componente <code>Y</code>, si dice che <code>X</code> è <em>di proprietà di</em> <code>Y</code>. Come discusso in precedenza, un componente non può mutare le sue <code>props</code> — sono sempre consistenti con il valore che il suo proprietario ha impostato. Questa invariante fondamentale porta a UI la cui consistenza può essere garantita.</p>

<p>È importante distinguere tra la relazione di proprietario-proprietà e la relazione genitore-figlio. La relazione proprietario-proprietà è specifica di React, mentre la relazione genitore-figlio è semplicemente quella che conosci e ami del DOM. Nell&#39;esempio precedente, <code>Avatar</code> possiede il <code>div</code>, le istanze di <code>ProfilePic</code> e <code>ProfileLink</code>, e <code>div</code> è il <strong>genitore</strong> (ma non il proprietario) delle istanze di <code>ProfilePic</code> e <code>ProfileLink</code>.</p>
<h2><a class="anchor" name="figli"></a>Figli <a class="hash-link" href="#figli">#</a></h2>
<p>Quando crei un&#39;istanza di un componente React, puoi includere componenti React aggiuntivi o espressioni JavaScript tra i tag di apertura e chiusura come segue:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">Parent</span><span class="o">&gt;&lt;</span><span class="nx">Child</span> <span class="o">/&gt;&lt;</span><span class="err">/Parent&gt;</span>
</code></pre></div>
<p><code>Parent</code> può accedere ai propri figli leggendo la speciale proprietà <code>this.props.children</code>. <strong><code>this.props.children</code> è una struttura dati opaca:</strong> usa le <a href="/react/docs/top-level-api.html#react.children">utilità React.Children</a> per manipolare i figli.</p>
<h3><a class="anchor" name="riconciliazione-dei-figli"></a>Riconciliazione dei Figli <a class="hash-link" href="#riconciliazione-dei-figli">#</a></h3>
<p><strong>La riconciliazione è il processo per il quale React aggiorna il DOM ad ogni passata di rendering.</strong> In generale, i figli sono riconciliati secondo l&#39;ordine in cui sono mostrati. Per esempio, supponiamo che due passate di rendering generino rispettivamente il markup seguente:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html">// Prima passata di rendering
<span class="nt">&lt;Card&gt;</span>
  <span class="nt">&lt;p&gt;</span>Paragrafo 1<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>Paragrafo 2<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/Card&gt;</span>
// Seconda passata di rendering
<span class="nt">&lt;Card&gt;</span>
  <span class="nt">&lt;p&gt;</span>Paragrafo 2<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/Card&gt;</span>
</code></pre></div>
<p>Intuitivamente, <code>&lt;p&gt;Paragrafo 1&lt;/p&gt;</code> è stato rimosso. Invece, React riconcilierà il DOM cambiando il testo contenuto nel primo figlio e distruggerà l&#39;ultimo figlio. React reconcilia secondo l&#39;<em>ordine</em> dei figli.</p>
<h3><a class="anchor" name="figli-dotati-di-stato"></a>Figli Dotati di Stato <a class="hash-link" href="#figli-dotati-di-stato">#</a></h3>
<p>Per molti componenti, questo non è un grande problema. Tuttavia, per i componenti dotati di stato che mantengono dati in <code>this.state</code> attraverso le diverse passate di rendering, questo può essere problematico.</p>

<p>In molti casi, questo problema può essere aggirato nascondendo gli elementi anziché distruggendoli:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html">// Prima passata di rendering
<span class="nt">&lt;Card&gt;</span>
  <span class="nt">&lt;p&gt;</span>Paragrafo 1<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>Paragrafo 2<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/Card&gt;</span>
// Seconda passata di rendering
<span class="nt">&lt;Card&gt;</span>
  <span class="nt">&lt;p</span> <span class="na">style=</span><span class="s">{{display:</span> <span class="err">&#39;</span><span class="na">none</span><span class="err">&#39;}}</span><span class="nt">&gt;</span>Paragrafo 1<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>Paragrafo 2<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/Card&gt;</span>
</code></pre></div><h3><a class="anchor" name="figli-dinamici"></a>Figli Dinamici <a class="hash-link" href="#figli-dinamici">#</a></h3>
<p>La situazione si complica quando i figli sono rimescolati (come nei risultati della ricerca) o se nuovi componenti sono aggiunti all&#39;inizio della lista (come negli stream). In questi casi quando l&#39;identità e lo stato di ogni figlio deve essere preservato attraverso passate di rendering, puoi unicamente identificare ciascun figlio assegnandogli una proprietà <code>key</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">results</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">ol</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="nx">results</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">result</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="nx">result</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/li&gt;;</span>
        <span class="p">})}</span>
      <span class="o">&lt;</span><span class="err">/ol&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
</code></pre></div>
<p>Quando React riconcilia i figli dotati di <code>key</code>, si assicurerà che ciascun figlio con la proprietà <code>key</code> sia riordinato (anziché  clobbered) o distrutto (anziché riutilizzato).</p>

<p>La proprietà <code>key</code> dovrebbe <em>sempre</em> essere fornita direttamente all&#39;elemento del componente nell&#39;array, non al contenitore HTML di ciascun componente dell&#39;array:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// SBAGLIATO!</span>
<span class="kd">var</span> <span class="nx">ListItemWrapper</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/li&gt;;</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="kd">var</span> <span class="nx">MyComponent</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="o">&lt;</span><span class="nx">ListItemWrapper</span> <span class="nx">data</span><span class="o">=</span><span class="p">{</span><span class="nx">result</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">;</span>
        <span class="p">})}</span>
      <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div><div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Corretto :)</span>
<span class="kd">var</span> <span class="nx">ListItemWrapper</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&lt;</span><span class="nx">li</span><span class="o">&gt;</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">text</span><span class="p">}</span><span class="o">&lt;</span><span class="err">/li&gt;;</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="kd">var</span> <span class="nx">MyComponent</span> <span class="o">=</span> <span class="nx">React</span><span class="p">.</span><span class="nx">createClass</span><span class="p">({</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">return</span> <span class="o">&lt;</span><span class="nx">ListItemWrapper</span> <span class="nx">key</span><span class="o">=</span><span class="p">{</span><span class="nx">result</span><span class="p">.</span><span class="nx">id</span><span class="p">}</span> <span class="nx">data</span><span class="o">=</span><span class="p">{</span><span class="nx">result</span><span class="p">}</span><span class="o">/&gt;</span><span class="p">;</span>
        <span class="p">})}</span>
      <span class="o">&lt;</span><span class="err">/ul&gt;</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>Puoi anche assegnare chiavi ai figli passandogli un oggetto ReactFragment. Leggi <a href="create-fragment.html">Frammenti con Chiave</a> per maggiori dettagli.</p>
<h2><a class="anchor" name="flusso-dei-dati"></a>Flusso dei Dati <a class="hash-link" href="#flusso-dei-dati">#</a></h2>
<p>In React, i dati fluiscono dal proprietario al componente posseduto attraverso le <code>props</code> come discusso in precedenza. Questo è a tutti gli effetti un binding di dati unidirezionale: i proprietari legano le proprietà dei componenti di loro proprietà a dei valori che il proprietario stesso ha calcolato in base ai propri <code>props</code> o <code>state</code>. Dal momento che questo processo avviene ricorsivamente, i cambiamenti dei dati vengono riflessi automaticamente ovunque vengano usati.</p>
<h2><a class="anchor" name="una-nota-sulle-prestazioni"></a>Una Nota sulle Prestazioni <a class="hash-link" href="#una-nota-sulle-prestazioni">#</a></h2>
<p>Ti starai chiedendo che cambiare i dati sia un&#39;operazione costosa in presenza di un gran numero di nodi sotto un proprietario. La buona notizia è che JavaScript è veloce e i metodi <code>render()</code> tendono ad essere molto semplici, quindi in molte applicazioni questo è un processo estremamente veloce. Inoltre, il collo di bottiglia è quasi sempre la mutazione del DOM e non l&#39;esecuzione di JS. React ottimizzerà tutto per te usando il raggruppamento e osservando i cambiamenti.</p>

<p>Tuttavia, a volte vorrai avere un controllo più raffinato sulle tue prestazioni. In tal caso, ridefinisci il metodo <code>shouldComponentUpdate()</code> per restituire false quando vuoi che React salti il trattamento di un sottoalbero. Consulta <a href="/react/docs/component-specs.html">la documentazione di riferimento di React</a> per maggiori informazioni.</p>

<blockquote>
<p>Nota:</p>

<p>Se <code>shouldComponentUpdate()</code> restituisce false quando i dati sono effettivamente cambiati, React non è in grado di mantenere la tua UI in sincronia. Assicurati di usare questa tecnica con cognizione di causa, e soltanto in presenza di problemi percettibili di prestazioni. Non sottovalutare l&#39;estrema velocità di esecuzione di JavaScript se paragonata a quella del DOM.</p>
</blockquote>
