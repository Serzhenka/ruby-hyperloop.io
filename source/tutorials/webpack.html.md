## Webpack for managing front-end assets

[The source code to this tutorial is here](https://github.com/barriehadfield/reactrb-showcase)

There are three parts to setting up Webpack:  

* Setting up NPM (node package manager) for the project
* Setting up Webpack
* Updating the rails asset pipeline to use the bundles generated by Webpack

This is just a matter of adding 4 boiler plate files, and updating two of your rails files.

First add a package.json file to your root directory (same place as your Gemfile) like this:

	// package.json
	{
		"name": "reactrb-showcase",
		"version": "0.0.1",
		"dependencies": {
			"bootstrap": "^3.3.6",
			"react": "^0.14.2",      
			"react-dom": "^0.14.2",
			"react-bootstrap": "^0.29.5",
			"webpack": "^1.13.1"
		},
			"devDependencies": {
		}
	}

Notice how similar this is to your Gemfile.

Now run `npm install` which will make sure you have all these packages.

So that we can run Webpack from the command line do a `npm install webpack -g`

Now that we have Webpack, we need to add 3 boiler plate files to configure it.  As you add more javascript packages you will be updating these files.  Again this is similar to updating your Gemfile when you add new gems to a project.

Add webpack.config.js to the root of your project:

```javascript
var path = require("path");

module.exports = {
    context: __dirname,
    entry: {
      client_only:  "./webpack/client_only.js",
      client_and_server: "./webpack/client_and_server.js"
    },
    output: {
      path: path.join(__dirname, 'app', 'assets',   'javascripts', 'webpack'),
      filename: "[name].js",
      publicPath: "/webpack/"
    },
    module: {
      loaders: [
        // add any loaders here
      ]
    },
    resolve: {
      root: path.join(__dirname, '..', 'webpack')
    },
};
```
and create a folder called `webpack` and add the following two files:

```javascript
// webpack/client_only.js
// any packages that depend specifically on the DOM go here
// for example the webpack css loader generates code that will break prerendering
console.log('client_only.js loaded');
```

```javascript
// webpack/client_and_server.js
// all other packages that you can run on both server (prerendering) and client go here
// most well behaved packages can be required here
ReactDOM = require('react-dom')
React = require('react')
console.log('client_and_server.js loaded')
```

Now run `webpack` from the command line.  This will grab all necessary dependencies and package them up into the `client_and_server.js` and `client_only.js` bundles.  If you look in the `app/assets/javascripts/webpack` directory you should see the two files there.

Finally we need to require these two bundles into our rails asset pipeline.

Edit `app/assets/javascript/application.js` and add
```javascript
//= require 'webpack/client_only'
```
just *above* the line that reads `Opal.load('components');`.  This will pull in any webpack assets that can only run on the client.

Then edit `app/views/components.rb` and replace the `require 'react'` line with
```ruby
require 'webpack/client_and_server.js'
```

In otherwords instead of pulling in react from the react-rails gem, we are going to pull in react *and* any other javascript packages we want from our webpack bundle.

Reactrb can automatically access our components loaded by Webpack, but we have to opt in to this behavior.  Edit `app/views/components.rb` and add
```ruby
require 'reactrb/auto-import'
```

immediately after `require 'reactrb'` (which is right near the top of the file.)  Auto-import will now search the javascript name space, and import into ruby any components that are referenced by your Reactrb components.

Now run `bundle exec rails s` and refresh the browser.  Look at the console and you should see something like this:

```text
client_and_server.js loaded
client_only.js loaded
client_and_server.js loaded
************************ React Prerendering Context Initialized Show ***********************
************************ React Browser Context Initialized ****************************
Reactive record prerendered data being loaded: [Object]
```
Well done - you are all setup!
