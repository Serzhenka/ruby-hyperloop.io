<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="google-site-verification" content="qjqVOvRhHfsuDbLOvaAnj2mkUZJ9Xwzg84TMVXduvUc" />

    <meta charset="UTF-8">
    <title>Hyperloop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>

    <link href="/stylesheets/base.css" rel="stylesheet" />
    <link href="/stylesheets/normalize.css" rel="stylesheet" />
    <link href="/stylesheets/stylesheet.css" rel="stylesheet" />
    <link href="/stylesheets/github-light.css" rel="stylesheet" />

    <title>Reactrb</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml" />

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/images/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

  </head>

  <body>
      <section class="page-header">
        <img src="/images/hyperloop_white.svg" width="200" alt="Hyperloop white" />
        <h1 class="project-name">
          <a href="/" class="btn-logo">Hyperloop</a>
        </h1>
        <h2 class="project-tagline">THE MISSING RUBY FRONT-END LIBRARY</h2>
        <a href="/get_started" class="btn">Get Started</a>
        <a href="/tutorials/chat_app" class="btn">Tutorials</a>
        <a href="/installation" class="btn">Installation</a>
        <a href="/gems" class="btn">Gems</a>
        <a href="https://github.com/reactrb" class="btn">Github</a>
        <a href="/tools" class="btn">Tooling</a>
        <a href="/docs/dsl_overview" class="btn">Docs</a>
        <a href="/support" class="btn">Support</a>
        <a href="/blog" class="btn">Blog</a>
      </section>

      <section class="main-nav">
          <a href="/tutorials/chat_app">Chat-App Tutorial</a></br>
  <a href="/tutorials/rails">Reactrb and Rails</a></br>
  <a href="/tutorials/react_components">React Components</a></br>
  <a href="/tutorials/reactive_record">Reactive Record</a></br>
  <a href="/tutorials/synchromesh">Synchromesh</a></br>

      </section>

      <section class="main-content">
        <h2 id="webpack-for-managing-front-end-assets">Webpack for managing front-end assets</h2>

<p><a href="https://github.com/barriehadfield/reactrb-showcase">The source code to this tutorial is here</a></p>

<p>There are three parts to setting up Webpack:  </p>

<ul>
<li>Setting up NPM (node package manager) for the project</li>
<li>Setting up Webpack</li>
<li>Updating the rails asset pipeline to use the bundles generated by Webpack</li>
</ul>

<p>This is just a matter of adding 4 boiler plate files, and updating two of your rails files.</p>

<p>First add a package.json file to your root directory (same place as your Gemfile) like this:</p>
<pre class="highlight plaintext"><code>// package.json
{
    "name": "reactrb-showcase",
    "version": "0.0.1",
    "dependencies": {
        "bootstrap": "^3.3.6",
        "react": "^0.14.2",      
        "react-dom": "^0.14.2",
        "react-bootstrap": "^0.29.5",
        "webpack": "^1.13.1"
    },
        "devDependencies": {
    }
}
</code></pre>
<p>Notice how similar this is to your Gemfile.</p>

<p>Now run <code>npm install</code> which will make sure you have all these packages.</p>

<p>So that we can run Webpack from the command line do a <code>npm install webpack -g</code></p>

<p>Now that we have Webpack, we need to add 3 boiler plate files to configure it.  As you add more javascript packages you will be updating these files.  Again this is similar to updating your Gemfile when you add new gems to a project.</p>

<p>Add webpack.config.js to the root of your project:</p>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">"path"</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">context</span><span class="p">:</span> <span class="nx">__dirname</span><span class="p">,</span>
    <span class="na">entry</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">client_only</span><span class="p">:</span>  <span class="s2">"./webpack/client_only.js"</span><span class="p">,</span>
      <span class="na">client_and_server</span><span class="p">:</span> <span class="s2">"./webpack/client_and_server.js"</span>
    <span class="p">},</span>
    <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'app'</span><span class="p">,</span> <span class="s1">'assets'</span><span class="p">,</span>   <span class="s1">'javascripts'</span><span class="p">,</span> <span class="s1">'webpack'</span><span class="p">),</span>
      <span class="na">filename</span><span class="p">:</span> <span class="s2">"[name].js"</span><span class="p">,</span>
      <span class="na">publicPath</span><span class="p">:</span> <span class="s2">"/webpack/"</span>
    <span class="p">},</span>
    <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">loaders</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1">// add any loaders here</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="na">resolve</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">root</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">'..'</span><span class="p">,</span> <span class="s1">'webpack'</span><span class="p">)</span>
    <span class="p">},</span>
<span class="p">};</span>
</code></pre>
<p>and create a folder called <code>webpack</code> and add the following two files:</p>
<pre class="highlight javascript"><code><span class="c1">// webpack/client_only.js</span>
<span class="c1">// any packages that depend specifically on the DOM go here</span>
<span class="c1">// for example the webpack css loader generates code that will break prerendering</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'client_only.js loaded'</span><span class="p">);</span>
</code></pre><pre class="highlight javascript"><code><span class="c1">// webpack/client_and_server.js</span>
<span class="c1">// all other packages that you can run on both server (prerendering) and client go here</span>
<span class="c1">// most well behaved packages can be required here</span>
<span class="nx">ReactDOM</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react-dom'</span><span class="p">)</span>
<span class="nx">React</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'react'</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'client_and_server.js loaded'</span><span class="p">)</span>
</code></pre>
<p>Now run <code>webpack</code> from the command line.  This will grab all necessary dependencies and package them up into the <code>client_and_server.js</code> and <code>client_only.js</code> bundles.  If you look in the <code>app/assets/javascripts/webpack</code> directory you should see the two files there.</p>

<p>Finally we need to require these two bundles into our rails asset pipeline.</p>

<p>Edit <code>app/assets/javascript/application.js</code> and add
<code>javascript
//= require &#39;webpack/client_only&#39;
</code>
just <em>above</em> the line that reads <code>Opal.load(&#39;components&#39;);</code>.  This will pull in any webpack assets that can only run on the client.</p>

<p>Then edit <code>app/views/components.rb</code> and replace the <code>require &#39;react&#39;</code> line with
<code>ruby
require &#39;webpack/client_and_server.js&#39;
</code></p>

<p>In otherwords instead of pulling in react from the react-rails gem, we are going to pull in react <em>and</em> any other javascript packages we want from our webpack bundle.</p>

<p>Reactrb can automatically access our components loaded by Webpack, but we have to opt in to this behavior.  Edit <code>app/views/components.rb</code> and add
<code>ruby
require &#39;reactrb/auto-import&#39;
</code></p>

<p>immediately after <code>require &#39;reactrb&#39;</code> (which is right near the top of the file.)  Auto-import will now search the javascript name space, and import into ruby any components that are referenced by your Reactrb components.</p>

<p>Now run <code>bundle exec rails s</code> and refresh the browser.  Look at the console and you should see something like this:</p>
<pre class="highlight plaintext"><code>client_and_server.js loaded
client_only.js loaded
client_and_server.js loaded
************************ React Prerendering Context Initialized Show ***********************
************************ React Browser Context Initialized ****************************
Reactive record prerendered data being loaded: [Object]
</code></pre>
<p>Well done - you are all setup!</p>

      </section>


  </body>
</html>
